<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BookEase - Dashboard</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Poppins', sans-serif; }
    .reservation-card:hover { transform: translateY(-3px); box-shadow: 0 12px 20px -8px rgba(0,0,0,.15); }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm py-4 px-6 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <i data-feather="calendar" class="text-indigo-600"></i>
      <span class="text-xl font-bold text-indigo-700">BookEase</span>
    </div>
    <div class="hidden md:flex space-x-6">
      <a href="index.html" class="text-indigo-600 font-medium">Dashboard</a>
      <a href="calendar.html" class="text-gray-600 hover:text-indigo-600">Calendar</a>
      <a href="new-reservation.html" class="text-gray-600 hover:text-indigo-600">New Reservation</a>
    </div>
    <div class="flex items-center space-x-4">
      <a href="new-reservation.html" class="px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 hidden sm:inline-flex items-center space-x-2">
        <i data-feather="plus" class="w-4 h-4"></i><span>New Booking</span>
      </a>
      <button class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200" aria-label="Notifications"><i data-feather="bell"></i></button>
      <div class="w-8 h-8 rounded-full bg-indigo-600 flex items-center justify-center text-white font-medium">JD</div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- Sidebar -->
      <aside class="w-full md:w-72 bg-white rounded-xl shadow-sm p-6 h-fit">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h2>
        <a href="new-reservation.html" class="w-full flex items-center space-x-2 bg-indigo-600 text-white py-3 px-4 rounded-lg mb-3 hover:bg-indigo-700 transition">
          <i data-feather="plus"></i><span>New Reservation</span>
        </a>
        <a href="calendar.html" class="w-full flex items-center space-x-2 bg-white text-gray-700 py-3 px-4 rounded-lg mb-3 border border-gray-200 hover:bg-gray-50 transition">
          <i data-feather="calendar"></i><span>Open Calendar</span>
        </a>

        <h2 class="text-lg font-semibold text-gray-800 mt-8 mb-4">Today's Stats</h2>
        <div class="space-y-4">
          <div class="flex justify-between items-center"><span class="text-gray-600">Reservations</span><span id="statCount" class="font-medium text-indigo-600">0</span></div>
          <div class="flex justify-between items-center"><span class="text-gray-600">Guests</span><span id="statGuests" class="font-medium">0</span></div>
        </div>
      </aside>

      <!-- Main Dashboard -->
      <main class="flex-1">
        <section class="bg-white rounded-xl shadow-sm p-6 mb-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-800">Today's Reservations</h2>
            <div class="flex space-x-2">
              <button id="refreshBtn" class="p-2 rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200" aria-label="Refresh"><i data-feather="refresh-ccw"></i></button>
            </div>
          </div>

          <div id="todayList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Cards injected here -->
          </div>

          <div id="emptyState" class="hidden text-center text-gray-500 py-8">
            No bookings for today yet. <a class="text-indigo-600 hover:text-indigo-800" href="new-reservation.html">Create one</a>.
          </div>
        </section>

        <!-- Upcoming Section -->
        <section class="bg-white rounded-xl shadow-sm p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold text-gray-800">Next 7 Days</h2>
            <a href="calendar.html" class="flex items-center space-x-1 text-indigo-600 hover:text-indigo-800">
              <span>View Calendar</span><i data-feather="chevron-right" class="w-4 h-4"></i>
            </a>
          </div>
          <ul id="upcomingList" class="divide-y divide-gray-100">
            <!-- Upcoming items injected here -->
          </ul>
        </section>
      </main>
    </div>
  </div>

  <script>
    const LS_KEY = 'bookease_bookings';

    function loadBookings() {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || []; }
      catch { return []; }
    }
    function saveBookings(list) {
      localStorage.setItem(LS_KEY, JSON.stringify(list));
    }
    function fmtDateTime(dtStr) {
      const d = new Date(dtStr);
      return d.toLocaleString();
    }
    function isToday(dtStr) {
      const d = new Date(dtStr);
      const now = new Date();
      return d.getFullYear() === now.getFullYear() &&
             d.getMonth() === now.getMonth() &&
             d.getDate() === now.getDate();
    }
    function calcGuests(bookings) {
      return bookings.reduce((sum, b) => sum + (parseInt(b.partySize||0) || 0), 0);
    }
    function ensureSeed() {
      // optional: seed example if empty (comment out if not desired)
      const existing = loadBookings();
      if (existing.length === 0) {
        const dt = new Date(); dt.setHours(19, 30, 0, 0);
        existing.push({
          id: crypto.randomUUID(),
          firstName: 'Sample',
          lastName: 'Booking',
          email: 'sample@example.com',
          phone: '000-000-0000',
          partySize: 2,
          date: dt.toISOString().slice(0,10),
          time: dt.toTimeString().slice(0,5),
          notes: 'Welcome to BookEase!'
        });
        saveBookings(existing);
      }
    }
    function bookingStartISO(b) {
      return new Date(`${b.date}T${b.time}`).toISOString();
    }

    function render() {
      const bookings = loadBookings().sort((a,b)=> new Date(bookingStartISO(a)) - new Date(bookingStartISO(b)));
      const today = bookings.filter(b => isToday(bookingStartISO(b)));
      const todayList = document.getElementById('todayList');
      const empty = document.getElementById('emptyState');
      todayList.innerHTML = '';

      if (today.length === 0) {
        empty.classList.remove('hidden');
      } else {
        empty.classList.add('hidden');
        today.forEach(b => {
          const card = document.createElement('div');
          card.className = 'reservation-card bg-white border border-gray-200 rounded-xl p-4 transition';
          card.innerHTML = `
            <div class="flex justify-between items-start mb-3">
              <div>
                <h3 class="font-medium text-gray-800">${b.firstName} ${b.lastName}</h3>
                <p class="text-sm text-gray-500">${b.partySize} guests</p>
              </div>
              <span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Confirmed</span>
            </div>
            <div class="flex items-center text-gray-600 mb-2">
              <i data-feather="clock" class="w-4 h-4 mr-2"></i><span>${fmtDateTime(bookingStartISO(b))}</span>
            </div>
            <div class="flex items-center text-gray-600 mb-4">
              <i data-feather="phone" class="w-4 h-4 mr-2"></i><span>${b.phone}</span>
            </div>
            <div class="flex justify-between">
              <a href="calendar.html" class="text-sm text-indigo-600 hover:text-indigo-800">View in calendar</a>
              <div class="flex space-x-2">
                <button data-id="${b.id}" class="delBtn p-1 text-gray-500 hover:text-red-600" aria-label="Delete">
                  <i data-feather="trash-2" class="w-4 h-4"></i>
                </button>
              </div>
            </div>`;
          todayList.appendChild(card);
        });
      }

      // stats
      document.getElementById('statCount').textContent = today.length;
      document.getElementById('statGuests').textContent = calcGuests(today);

      // upcoming 7 days
      const now = new Date();
      const weekAhead = new Date(); weekAhead.setDate(now.getDate()+7);
      const upcoming = bookings.filter(b => {
        const d = new Date(bookingStartISO(b));
        return d >= now && d <= weekAhead;
      });
      const ul = document.getElementById('upcomingList');
      ul.innerHTML = '';
      upcoming.forEach(b=>{
        const li = document.createElement('li');
        li.className='py-3 flex items-center justify-between';
        li.innerHTML = `
          <div>
            <p class="font-medium text-gray-800">${b.firstName} ${b.lastName} <span class="text-sm text-gray-500">(${b.partySize})</span></p>
            <p class="text-sm text-gray-500">${fmtDateTime(bookingStartISO(b))}</p>
          </div>
          <a href="calendar.html" class="text-indigo-600 hover:text-indigo-800 text-sm">Open</a>`;
        ul.appendChild(li);
      });

      feather.replace();

      // delete handlers
      document.querySelectorAll('.delBtn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-id');
          const remaining = loadBookings().filter(b => b.id !== id);
          saveBookings(remaining);
          render();
        });
      });
    }

    document.getElementById('refreshBtn').addEventListener('click', render);

    ensureSeed();
    render();
  </script>
</body>
</html>
